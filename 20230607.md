# 6월 7일

## pafy를 사용하여 유튜브 열기
- 참조 : https://syerco0.com/37
- 설치 파일
  - pip install pafy
  - pip install youtube-dl
- 변경사항
  - youtube.py 파일의 1794번째 줄에 있는 아래의 코드를
    - 'uploader_id': self._search_regex(r'/(?:channel|user)/([^/?&#]+)', owner_profile_url, 'uploader id') if owner_profile_url else None,
  - 이 코드로 바꿔줌 
    - 'uploader_id': self._search_regex(r'/(?:channel/|user/|@)([^/?&#]+)', owner_profile_url, 'uploader id', default=None),
  - 이후 line 53, in fetch_basic self.likes = self.ydl info['like_count']' 라는 오류가 발생하면
    - 53번과 54번 줄을
    - # self._likes = self._ydl_info['like_count']
    - # self._dislikes = self._ydl_info['dislike_count']
    - 각각 아래와 같이 바꿔줌
    - self._likes = self._ydl_info.get('like_count', 0)
    - self._dislikes = self._ydl_info.get('dislike_count', 0)
```python
import cv2
import pafy

#pip install pafy
#pip install youtube-dl

#pafy 오류 수정 참조:
#https://syerco0.com/37

# 해당경로만 youtube.py 파일을 찾아서 연다
# 밑의 경로를 통해 youtube.py라는 파일을 찾아서 열어줌
# ./venv/lib/python3.8/site-packeges/youtube_dl/extractor/youtube.py
# 검색 'uploader.id': self. 후 해당 줄의 내용을 변경
# 변경될 내용 => 'uploader_id': self._search_regex(r'/(?:channel/|user/|@)([^/?&#]+)', owner_profile_url, 'uploader id', default=None),
# 정규식에 @ 추가됨

# key 인덱스 에러 수정 ('like_count', 'dislike_count')
# backend_youtube.dl.py 파일을 찾아서 넣음
# /home/ajh/Project/aaa/venv/lib/python3.8/site-packages/pafy/backend_youtube_dl.py"
# # self._likes = self._ydl_info['like_count']
# self._dislikes = self._ydl_info['dislike_count']
# 위의 각각을 아래로 변경
# self._likes = self._ydl_info.get('like_count', 0)
#self._dislikes = self._ydl_info.get('dislike_count', 0)

url = "https://www.youtube.com/watch?v=A94W0NvGYA0"

video = pafy.new(url)

best = video.getbest()

# 버퍼 열림 (캡쳐 시작)
cap = cv2.VideoCapture(best.url)

# 파일이 정상적으로 열렸는지 확인
if cap.isOpened():
    while True:
        ret, frame = cap.read()

        if not ret:
            break

        cv2.imshow(best.url, frame)
        if cv2.waitKey(25) >= 0:
            break


#버퍼 닫음 (캡쳐 종료)
cv2.release()
cv2.destroyAllWindows()
```

> 실행 결과

![Screenshot from 2023-06-07 12-26-53](https://github.com/ajhwan/OpenCV_study/assets/129160008/606ee326-36be-4fdf-91b6-9ab47f748884)
